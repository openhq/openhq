<!DOCTYPE html>
<html>
<head>
  <%= render partial: "layouts/html_head" %>
</head>
<body>
  <%= render 'shared/flash_messages' %>

  <header class="app-header">
    <div class="page-container">
      <span class="close-cross mobile-only">&times;</span>
      <menu>
        <%# Team switcher %>
        <% if current_user.teams.size > 1 %>
          <div class="ui-dropdown-menu">
            <span class="title noselect"><%= current_team.name %><span class="arrow"></span></span>
            <ul class="dropdown">
              <% current_user.teams.each do |team| %>
                <li><%= link_to(team.name, root_url(subdomain: team.subdomain)) %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <% present current_user do |user| %>
          <div class="ui-dropdown-menu">
            <span class="title noselect"><%= user.display_name %><span class="arrow"></span></span>
            <ul class="dropdown">
              <li><%= link_to(t("user.account"), edit_account_path) %></li>
              <li><%= link_to(t("auth.sign_out"), sign_out_path, :method => :delete) %></li>
            </ul>
          </div>
        <% end %>
      </menu>

      <nav>
        <ul>
          <li class="brand"><%= link_to current_team.name, root_url %></li>
          <li><%= link_to t('projects'), projects_path %></li>
          <li><%= link_to t('files'), files_path %></li>
          <li><%= link_to t('team'), team_index_path %></li>
          <li class="mobile-only"><%= link_to(t("user.account"), edit_account_path) %></li>
          <li class="mobile-only"><%= link_to(t("auth.sign_out"), sign_out_path, :method => :delete) %></li>
          <li>
            <form action="<%= search_index_path %>" method="GET" class="search">
              <input type="text" name="q" placeholder="Search" autocomplete="off" />
            </form>
          </li>
        </ul>
      </nav>
    </div>
  </header>


  <div class="page-container">
    <%= yield %>
  </div>

  <script type="text/javascript">
    <% cache :all_emojis_list do %>
    App.emojis = <%== MultiJson.dump(Emoji.all.map(&:name)) %>;
    <% end %>
    <% cache User.all_cache_key do %>
    App.users = <%== MultiJson.dump(ActiveModel::ArraySerializer.new(User.active, each_serializer: PublicUserSerializer, root: false), pretty: true) %>;
    <% end %>
  </script>

</body>
</html>
