<h1>
  <%= @story.name %>
  <small><%= link_to @story.project.name, @story.project %></small>
</h1>

<div class="ui-story">
  <article>
    <header>
      <div class="actions">
        <%= link_to "Edit", edit_project_story_path(@story.project, @story) if can? :edit, @story %>
      </div>
      <%= present(@story.owner).avatar_link(30) %>
      <%= present(@story.owner).full_name %> added <%= human_time @story.created_at %>
    </header>
    <section class="body">
      <%= markdownify @story.description %>
    </section>
  </article>
  <div class="tasks">
    <% if @story.tasks.empty? %>
      <p>No tasks</p>

    <% else %>
      <h4><%= pluralize(@story.tasks.incomplete.count, "Incomplete Task") %></h4>

        <ul>
          <% @story.tasks.each do |task| %>
            <li class="<%= "complete" if task.completed? %>">
              <label>
                <%= simple_form_for [@story.project, @story, task] do |f| %>
                  <input type="checkbox" <%= "checked" if task.completed? %>><%= task.label %>
                <% end %>
              </label>
            </li>
          <% end %>
        </ul>
    <% end %>

    <% if can? :create, Task.new %>
      <%= simple_form_for [@story.project, @story, Task.new], html: { class: "pure-form pure-form-stacked" } do |f| %>
        <%= f.input :label, label: false, placeholder: "Add a new task..." %>
      <% end %>
    <% end %>
  </div>
  <div class="attachments">
    <p>No attachments</p>
  </div>
  <% @story.comments.each do |comment| %>
  <article>
    <header>
      <div class="actions">
        <%= link_to "Edit", edit_project_story_comment_path(@story.project, @story, comment) if can? :edit, comment %>
      </div>
      <%= present(comment.owner).avatar_link(30) %>
      <%= present(comment.owner).full_name %> added <%= human_time comment.created_at %>
    </header>
    <section class="body">
      <%= markdownify comment.content %>
    </section>
  </article>
  <% end %>
  <div class="add-comment content-input">
    <header class="plain">
      <%= present(current_user).avatar_link(30) %> Reply to this topic
    </header>
    <%= simple_form_for [@story.project, @story, Comment.new], html: {class: "pure-form pure-form-stacked"} do |f| %>
      <%= render 'shared/text_box', form: f, method: :content %>
      <footer>
        <%= f.submit "Reply", class: "btn btn-main" %>
      </footer>
    <% end %>

    <%= simple_form_for [@story.project, @story, Attachment.new], html: { id: "attachment-uploads" } do |f| %>
      <%= f.file_field :file %>
    <% end %>
  </div>
</div>


